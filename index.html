<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Diagram Generator</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="32" height="32" rx="6" fill="#4F46E5"/>
                    <path d="M8 16L14 10L20 16L14 22L8 16Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                    <circle cx="22" cy="10" r="2" fill="white"/>
                    <circle cx="22" cy="22" r="2" fill="white"/>
                </svg>
                <h1>Blueprint Generator</h1>
            </div>
            <div class="header-actions">
                <label for="file-upload" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Upload JSON
                </label>
                <input type="file" id="file-upload" accept=".json" style="display: none;">
                
                <button id="load-example" class="btn btn-secondary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    Load Example
                </button>

                <button id="ai-generator-btn" class="btn btn-secondary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    AI Generator
                </button>

                <button id="download-diagram" class="btn btn-secondary" style="display:none;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export PNG
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="welcome-screen">
                <div class="welcome-content">
                    <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="10" y="10" width="100" height="100" rx="20" stroke="#4F46E5" stroke-width="3" stroke-dasharray="8 8"/>
                        <rect x="30" y="30" width="25" height="25" rx="4" fill="#4F46E5"/>
                        <rect x="65" y="30" width="25" height="25" rx="4" fill="#4F46E5"/>
                        <rect x="30" y="65" width="25" height="25" rx="4" fill="#4F46E5"/>
                        <rect x="65" y="65" width="25" height="25" rx="4" fill="#4F46E5"/>
                        <line x1="42" y1="55" x2="42" y2="65" stroke="#9CA3AF" stroke-width="2"/>
                        <line x1="77" y1="55" x2="77" y2="65" stroke="#9CA3AF" stroke-width="2"/>
                        <line x1="55" y1="42" x2="65" y2="42" stroke="#9CA3AF" stroke-width="2"/>
                    </svg>
                    <h2>Welcome to Blueprint Generator</h2>
                    <p>Upload a JSON file to visualize your cloud architecture</p>
                    <div class="welcome-actions">
                        <label for="file-upload-welcome" class="btn btn-primary btn-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Upload JSON File
                        </label>
                        <input type="file" id="file-upload-welcome" accept=".json" style="display: none;">
                        
                        <button id="load-example-welcome" class="btn btn-secondary btn-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            Try Example
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Generator Section -->
            <div id="ai-generator-screen" class="ai-generator-screen" style="display: none;">
                <div class="ai-generator-content">
                    <div class="ai-header">
                        <div class="ai-title-section">
                            <h2>
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                                AI Blueprint Generator
                            </h2>
                            <p>Upload markdown → AI generates JSON → Visualize your architecture</p>
                        </div>
                        <button id="close-ai-generator" class="close-btn-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>

                    <div class="ai-body">
                        <!-- Step 1: Upload -->
                        <div class="ai-step">
                            <div class="step-header">
                                <div class="step-number">1</div>
                                <div class="step-title">
                                    <h3>Upload Markdown</h3>
                                    <small>Describe your architecture in plain text</small>
                                </div>
                            </div>
                            <div class="step-content">
                                <label for="md-file-upload" class="upload-box-horizontal">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                    <div class="upload-text">
                                        <span>Click or drag .md files here</span>
                                        <small>Multiple files supported • Markdown format</small>
                                    </div>
                                </label>
                                <input type="file" id="md-file-upload" accept=".md,.markdown" multiple style="display: none;">
                                
                                <div id="md-preview" class="md-preview-compact" style="display: none;">
                                    <div class="preview-actions">
                                        <span id="file-count-badge" class="badge-success">0 files loaded</span>
                                        <button id="clear-md" class="btn-icon" title="Clear all files">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"/>
                                                <line x1="6" y1="6" x2="18" y2="18"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <pre id="md-content"></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Generate -->
                        <div class="ai-step">
                            <div class="step-header">
                                <div class="step-number">2</div>
                                <div class="step-title">
                                    <h3>Generate JSON</h3>
                                    <small id="model-info">Powered by Ollama (qwen2.5-coder:7b)</small>
                                </div>
                            </div>
                            <div class="step-content">
                                <button id="generate-json-btn" class="btn btn-primary btn-xl" disabled>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="5 3 19 12 5 21 5 3"/>
                                    </svg>
                                    Generate Architecture JSON
                                </button>

                                <div id="loading-indicator" class="loading-indicator-inline" style="display: none;">
                                    <div class="spinner-small"></div>
                                    <span>AI is analyzing your architecture...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Result -->
                        <div class="ai-step">
                            <div class="step-header">
                                <div class="step-number">3</div>
                                <div class="step-title">
                                    <h3>Review & Visualize</h3>
                                    <small>Your generated architecture JSON</small>
                                </div>
                            </div>
                            <div class="step-content">
                                <div id="json-result" class="json-result-box" style="display: none;">
                                    <div class="json-actions-bar">
                                        <button id="copy-json-btn" class="btn btn-secondary" title="Copy to clipboard">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                            </svg>
                                            Copy
                                        </button>
                                        <button id="download-json-btn" class="btn btn-secondary" title="Download JSON file">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7 10 12 15 17 10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                            Download
                                        </button>
                                        <button id="visualize-json-btn" class="btn btn-primary">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                            </svg>
                                            Visualize Diagram
                                        </button>
                                    </div>
                                    <pre id="json-output"></pre>
                                </div>

                                <div id="available-icons" class="available-icons-compact">
                                    <details open>
                                        <summary>
                                            <h4>Available Icons</h4>
                                            <span id="icon-count" class="badge">0</span>
                                        </summary>
                                        <div id="icon-grid" class="icon-grid-compact"></div>
                                    </details>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagram Container -->
            <div id="diagram-container" class="diagram-container" style="display: none;">
                <div id="diagram-canvas" class="diagram-canvas">
                    <svg id="diagram-svg" width="100%" height="100%">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#4F46E5" />
                            </marker>
                        </defs>
                        <g id="diagram-group"></g>
                    </svg>
                </div>
                
                <!-- Controls Panel -->
                    <button id="zoom-in" class="control-btn" title="Zoom In">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="11" y1="8" x2="11" y2="14"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                    </button>
                    <button id="zoom-out" class="control-btn" title="Zoom Out">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                    </button>
                    <button id="fit-view" class="control-btn" title="Fit to View">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                    </button>
                    <button id="reset-layout" class="control-btn" title="Reset Layout">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </button>
                </div>

                <!-- Info Panel -->
                <div id="info-panel" class="info-panel">
                    <div class="info-header">
                        <h3>Diagram Info</h3>
                        <button id="close-info" class="close-btn" title="Toggle panel">×</button>
                    </div>
                    <div class="info-content">
                        <div class="info-item">
                            <span class="info-label">Nodes:</span>
                            <span id="node-count" class="info-value">0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Connections:</span>
                            <span id="edge-count" class="info-value">0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Containers:</span>
                            <span id="container-count" class="info-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Error Toast -->
        <div id="error-toast" class="toast toast-error" style="display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            <span id="error-message"></span>
        </div>

        <!-- Success Toast -->
        <div id="success-toast" class="toast toast-success" style="display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <span id="success-message"></span>
        </div>
        
        <!-- Icon Picker Modal -->
        <div id="icon-picker-modal" class="modal" style="display: none;">
            <div class="modal-content icon-picker-content">
                <div class="modal-header">
                    <h3>Select Icon</h3>
                    <button class="close-btn" onclick="closeIconPicker()">×</button>
                </div>
                <div class="modal-body">
                    <div class="icon-picker-search">
                        <input type="text" id="icon-search" placeholder="Search icons..." />
                        <select id="icon-category-filter">
                            <option value="all">All Categories</option>
                            <option value="AWS">AWS</option>
                            <option value="GCP">GCP</option>
                            <option value="Kubernetes">Kubernetes</option>
                            <option value="Monitoring">Monitoring</option>
                            <option value="General">General</option>
                        </select>
                    </div>
                    <div id="icon-picker-grid" class="icon-picker-grid"></div>
                </div>
            </div>
        </div>
    </div>

<!-- Application Modules -->
    <script src="scripts/utils.js"></script>
    <script src="scripts/layout-engine.js"></script>
    <script src="scripts/event-handlers.js"></script>
    <script src="scripts/diagram-core.js"></script>
    <script src="scripts/icon-picker.js"></script>
    <script src="scripts/main.js"></script>
    
    <!-- AI Generator Modules (load in dependency order) -->
    <script src="scripts/icon-validator.js"></script>
    <script src="scripts/ai-prompt-builder.js"></script>
    <script src="scripts/ai-generator.js"></script>
